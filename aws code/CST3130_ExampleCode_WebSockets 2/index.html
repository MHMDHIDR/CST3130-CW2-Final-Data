<!DOCTYPE html>
<html>

<head>
    <title>WebSocket Client</title>
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js" charset="utf-8"></script>
</head>

<body>
    <h1>Message for Server</h1>
    <div id="myDiv"></div>
    <form>
        <input type="text" name="inputString" />
        <button type="button" onclick="sendMessage()">Submit</button>
    </form>

    <h1>Messages from Server</h1>
    <p style="border-style: solid; width: 500px; border-width: 1px;" id="messages"></p>

    <script>
        //Open connection
        let connection = new WebSocket("wss://z2jcqjqxml.execute-api.us-east-1.amazonaws.com/production");


        //Log connected response
        connection.onopen = function (event) {
            console.log("Connected: " + JSON.stringify(event));
        };

        var data1 = [
            {
                x: ['2013-10-04 22:23:00', '2013-11-04 22:23:00', '2013-12-04 22:23:00'],
                y: [1, 3, 6],
                type: 'scatter'
            }
        ];

        //Output messages from the server
        connection.onmessage = function (msg) {
            let data = JSON.parse(msg.data);
            console.log(data);

            Plotly.newPlot('myDiv', data1);
        }

        //Log errors
        connection.onerror = function (error) {
            console.log("WebSocket Error: " + JSON.stringify(error));
        }

        //Send message to server
        function sendMessage() {
            //Get text from form
            let msgText = document.forms[0].inputString.value;

            //Create message to be sent to server
            let msgObject = {
                action: "sendMessage",//Used for routing in API Gateway
                data: { currency: msgText }
            };

            //Send message
            connection.send(JSON.stringify(msgObject));

            //Log result
            console.log("Message sent: " + JSON.stringify(msgObject));
        }


    </script>
</body>

</html>