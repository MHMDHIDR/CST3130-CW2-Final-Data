<!DOCTYPE html>
<html>

<head>
    <title>Qatari Riyals Exchange Rates</title>
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js" charset="utf-8"></script>
</head>

<body>
    <h1>Qatari Riyals | Exchange Rates</h1>
    <div id="myDiv"></div>
    <div id="currencyButtons">
        <button type="button" onclick="sendMessage('USD')">USD</button>
        <button type="button" onclick="sendMessage('GBP')">GBP</button>
        <button type="button" onclick="sendMessage('AMD')">AMD</button>
        <button type="button" onclick="sendMessage('PHP')">PHP</button>
        <button type="button" onclick="sendMessage('SEK')">SEK</button>
    </div>

    <h1>Messages from Server</h1>
    <p style="border-style: solid; width: 500px; border-width: 1px;" id="messages"></p>

    <script>
        // Open connection
        let connection = new WebSocket("wss://z2jcqjqxml.execute-api.us-east-1.amazonaws.com/production");

        // Log connected response
        connection.onopen = function (event) {
            console.log("Connected: " + JSON.stringify(event));
        };

        // Output messages from the server
        connection.onmessage = function (msg) {
            let data = JSON.parse(msg.data);
            console.log(data);

            // Assuming data is an array of x and y coordinates
            let plotData = [{
                x: data.x,
                y: data.y,
                type: 'line'
            }];

            Plotly.newPlot('myDiv', plotData);
        }

        // Log errors
        connection.onerror = function (error) {
            console.log("WebSocket Error: " + JSON.stringify(error));
        }

        // Send message to server with specified currency
        function sendMessage(currency) {
            // Create message to be sent to server
            let msgObject = {
                action: "sendMessage", // Used for routing in API Gateway
                data: { currency }
            };

            // Send message
            connection.send(JSON.stringify(msgObject));

            // Log result
            console.log("Message sent: " + JSON.stringify(msgObject));
        }

        // Handle WebSocket connection closure
        connection.onclose = function (event) {
            console.log("Connection closed: " + JSON.stringify(event));
        };
    </script>
</body>

</html>